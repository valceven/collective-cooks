{% comment %} {% extends 'layout.html' %}  {% endcomment %}

{% comment %} {% block title %} 
  Add Recipe
{% endblock %} 

{% block content %}
  <div class="form-group">
    <h1>Add Recipe</h1>
    <form method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit">Submit</button>
    </form>
  </div>
{% endblock %} {% endcomment %}

{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add a Recipe</title>
    <!-- Link to Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* Custom styles for file upload button */
        .file-upload {
            position: relative;
        }
        .file-upload input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-yellow-500 font-sans">

    <div class="container mx-auto my-8 p-6 bg-white rounded-lg shadow-lg max-w-3xl">
        <h1 class="text-3xl accent1 font-bold">Add a Recipe</h1>
        <p class="text-gray-700">Share your recipe to the world!</p>
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <!-- Recipe Name -->
            <div class="mb-4">
                <label for="recipe_name" class="block text-sm font-bold mb-2">Recipe Name</label>
                <input type="text" class="border border-gray-300 p-2 w-full rounded" id="recipe_name" placeholder="Enter title" name="title">
            </div>

            <!-- Description -->
            <div class="mb-4">
                <label for="description" class="block text-sm font-bold mb-2">Description</label>
                <textarea class="border border-gray-300 p-2 w-full rounded" id="description" rows="3" placeholder="Short Description of the Recipe..." name="description"></textarea>
            </div>

            <!-- Category -->
            <div class="mb-4">
                <label for="category" class="block text-sm font-bold mb-2">Category</label>
                <div class="flex space-x-2">
                    <button type="button" class="btn-category selected bg-red-600 text-white rounded-full px-4 py-2" onclick="selectCategory(this)">Breakfast</button>
                    <button type="button" class="btn-category bg-white border-red-600 text-red-600 rounded-full px-4 py-2" onclick="selectCategory(this)">Lunch</button>
                    <button type="button" class="btn-category bg-white border-red-600 text-red-600 rounded-full px-4 py-2" onclick="selectCategory(this)">Dinner</button>
                    <button type="button" class="btn-category bg-white border-red-600 text-red-600 rounded-full px-4 py-2" onclick="selectCategory(this)">Dessert</button>
                    <button type="button" class="btn-category bg-white border-red-600 text-red-600 rounded-full px-4 py-2" onclick="selectCategory(this)">Snack</button>
                </div>
            </div>

            <!-- Hidden input to store selected category -->
            <input type="hidden" name="category" id="selected_category" value="Breakfast">

            <!-- Ingredients -->
            <div class="mb-4" id="ingredients-container">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 ingredient-row mb-2">
                    <div>
                        <label for="ingredient" class="block text-sm font-bold mb-2">Ingredients</label>
                        <input type="text" class="border border-gray-300 p-2 w-full rounded" id="ingredient" placeholder="Ingredient 1..." name="ingredient">
                    </div>
                    <div>
                        <label for="amount" class="block text-sm font-bold mb-2">Amount</label>
                        <div class="flex items-center">
                            <input type="text" class="border border-gray-300 p-2 w-2/3 rounded" id="amount" placeholder="Amount" name="amount">
                            <button type="button" class="ml-2 bg-green-600 text-white rounded-full w-8 h-8 flex items-center justify-center" onclick="addIngredientRow(this)">+</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Procedure -->
            <div class="mb-4">
                <label for="procedure" class="block text-sm font-bold mb-2">Procedure</label>
                <div id="procedure-container">
                    <div class="procedure-step flex mb-2">
                        <input class="border border-gray-300 p-2 w-full rounded" id="procedure" rows="3" placeholder="Step 1..." name="procedure">
                        <button type="button" class="ml-2 bg-green-600 text-white rounded-full w-8 h-8 flex items-center justify-center" onclick="addProcedureStep(this)">+</button>
                    </div>
                </div>
            </div>

            <!-- Image Upload -->
            <div class="file-upload mb-4 flex items-center justify-center">
                <div class="flex items-center justify-center h-32 w-32 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50">
                    <input type="file" name="image">
                    <span class="text-4xl text-gray-500">+</span>
                </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="bg-red-600 text-white rounded-full px-6 py-2 hover:bg-orange-500">Add</button>
        </form>
    </div>

    <script>
        function selectCategory(button) {
            // Remove 'selected' class from all buttons
            const buttons = document.querySelectorAll('.btn-category');
            buttons.forEach(btn => {
                btn.classList.remove('bg-red-600', 'text-white');
                btn.classList.add('bg-white', 'border-red-600', 'text-red-600');
            });
            // Add 'selected' class to the clicked button
            button.classList.add('bg-red-600', 'text-white');
            button.classList.remove('bg-white', 'border-red-600', 'text-red-600');

            // Set the hidden input value to the selected category
            document.getElementById('selected_category').value = button.innerText;
        }
        
        let stepCount = 1;
    
        function addProcedureStep(button) {
            stepCount++; // Increment step count for the next row

            // Hide the + button of the previous row
            button.style.display = 'none';

            // Create a new ingredient row div
            const newProcedureDiv = document.createElement('div');
            newProcedureDiv.classList.add('procedure-step', 'flex','mb-2');

            // Create new step input
            const newStepInput = document.createElement('input');
            newStepInput.type = 'text';
            newStepInput.classList.add('border', 'border-gray-300', 'p-2', 'w-full', 'rounded');
            newStepInput.placeholder = `Step ${stepCount}...`;
            newStepInput.name = 'procedure';

            // Create new + button
            const newButton = document.createElement('button');
            newButton.type = 'button';
            newButton.classList.add('ml-2', 'bg-green-600', 'text-white', 'rounded-full', 'w-8', 'h-8', 'flex', 'items-center', 'justify-center');
            newButton.innerText = '+';
            newButton.setAttribute('onclick', 'addProcedureStep(this)');

            // Create new - button (only for subsequent rows)
            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.classList.add('ml-2', 'bg-red-600', 'text-white', 'rounded-full', 'w-8', 'h-8', 'flex', 'items-center', 'justify-center');
            removeButton.innerText = '-';
            removeButton.setAttribute('onclick', 'removeProcedureStep(this)');

            // Append new amount input and buttons to the amountDiv
            newProcedureDiv.appendChild(newStepInput);
            newProcedureDiv.appendChild(newButton);
            newProcedureDiv.appendChild(removeButton);

            // Insert the new row into the ingredients-container
            const ingredientsContainer = document.getElementById('procedure-container');
            ingredientsContainer.appendChild(newProcedureDiv);

            // Renumber all rows after adding a new one
            renumberProcedure();
        }

        function removeProcedureStep(button) {
            const procedureSteps = document.querySelectorAll('.procedure-step');

            // Ensure that at least one row remains (the first row can't be deleted)
            if (procedureSteps.length > 1) {
                const rowToRemove = button.closest('.procedure-step');
                rowToRemove.remove();

                // Renumber all rows after removing one
                renumberProcedure();

                // Make sure the + button is visible on the last row after removal
                const lastRow = document.querySelectorAll('.procedure-step')[document.querySelectorAll('.procedure-step').length - 1];
                const lastAddButton = lastRow.querySelector('button[onclick^="addProcedureStep"]');
                if (lastAddButton) {
                    lastAddButton.style.display = 'inline-flex'; // Show the + button again
                }
            }
        }

        // Function to renumber the procedure after addition or removal
        function renumberProcedure() {
            const procedureInputs = document.querySelectorAll('.procedure-step input[name="procedure"]');
            procedureInputs.forEach((input, index) => {
                input.placeholder = `Step ${index + 1}...`; // Renumber based on the index
            });
        }

        let ingredientCount = 1;

        function addIngredientRow(button) {
            ingredientCount++; // Increment ingredient count for the next row

            // Hide the + button of the previous row
            button.style.display = 'none';

            // Create a new ingredient row div
            const newRowDiv = document.createElement('div');
            newRowDiv.classList.add('grid', 'grid-cols-1', 'md:grid-cols-2', 'gap-4', 'ingredient-row', 'mb-2');

            // Create new ingredient input
            const newIngredientInput = document.createElement('input');
            newIngredientInput.type = 'text';
            newIngredientInput.classList.add('border', 'border-gray-300', 'p-2', 'w-full', 'rounded');
            newIngredientInput.placeholder = `Ingredient ${ingredientCount}...`;
            newIngredientInput.name = 'ingredient';

            // Create new div for amount input and +, - button
            const amountDiv = document.createElement('div');
            amountDiv.classList.add('flex', 'items-center');

            // Create new amount input (smaller width)
            const newAmountInput = document.createElement('input');
            newAmountInput.type = 'text';
            newAmountInput.classList.add('border', 'border-gray-300', 'p-2', 'w-2/3', 'rounded');
            newAmountInput.placeholder = 'Amount';
            newAmountInput.name = 'amount';

            // Create new + button
            const newButton = document.createElement('button');
            newButton.type = 'button';
            newButton.classList.add('ml-2', 'bg-green-600', 'text-white', 'rounded-full', 'w-8', 'h-8', 'flex', 'items-center', 'justify-center');
            newButton.innerText = '+';
            newButton.setAttribute('onclick', 'addIngredientRow(this)');

            // Create new - button (only for subsequent rows)
            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.classList.add('ml-2', 'bg-red-600', 'text-white', 'rounded-full', 'w-8', 'h-8', 'flex', 'items-center', 'justify-center');
            removeButton.innerText = '-';
            removeButton.setAttribute('onclick', 'removeIngredientRow(this)');

            // Append new amount input and buttons to the amountDiv
            amountDiv.appendChild(newAmountInput);
            amountDiv.appendChild(newButton);
            amountDiv.appendChild(removeButton);

            // Append new ingredient input and amountDiv to the newRowDiv
            newRowDiv.appendChild(newIngredientInput);
            newRowDiv.appendChild(amountDiv);

            // Insert the new row into the ingredients-container
            const ingredientsContainer = document.getElementById('ingredients-container');
            ingredientsContainer.appendChild(newRowDiv);

            // Renumber all rows after adding a new one
            renumberIngredients();
        }

        function removeIngredientRow(button) {
            const ingredientRows = document.querySelectorAll('.ingredient-row');

            // Ensure that at least one row remains (the first row can't be deleted)
            if (ingredientRows.length > 1) {
                const rowToRemove = button.closest('.ingredient-row');
                rowToRemove.remove();

                // Renumber all rows after removing one
                renumberIngredients();

                // Make sure the + button is visible on the last row after removal
                const lastRow = document.querySelectorAll('.ingredient-row')[document.querySelectorAll('.ingredient-row').length - 1];
                const lastAddButton = lastRow.querySelector('button[onclick^="addIngredientRow"]');
                if (lastAddButton) {
                    lastAddButton.style.display = 'inline-flex'; // Show the + button again
                }
            }
        }

        // Function to renumber the ingredients after addition or removal
        function renumberIngredients() {
            const ingredientInputs = document.querySelectorAll('.ingredient-row input[name="ingredient"]');
            ingredientInputs.forEach((input, index) => {
                input.placeholder = `Ingredient ${index + 1}...`; // Renumber based on the index
            });
        }
    </script>

</body>
</html>
